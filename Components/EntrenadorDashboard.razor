@page "/dashboard-entrenador/{dni}"
@rendermode InteractiveServer
@inject ProyectoGym.Business.EntrenadorService EntrenadorService
@inject ProyectoGym.Business.ClienteService ClienteService
@inject NavigationManager Navigation
@using ProyectoGym.Domain

<h3 class="text-center text-primary mb-4">Panel del Entrenador</h3>

@if (entrenador == null)
{
    <div class="alert alert-warning text-center">Entrenador no encontrado.</div>
}
else
{
    <button class="btn btn-secondary mb-3" @onclick="VolverAtras">← Volver</button>

    <div class="card p-3 mb-4 shadow-sm" style="max-width: 400px;">
        <h5 class="text-secondary">Entrenador logueado</h5>
        <p><strong>@entrenador.nombre @entrenador.apellido</strong></p>
        <p><small>DNI: @entrenador.dni</small></p>
        <p><small>Email: @entrenador.email</small></p>
        <p><small>Género: @entrenador.genero</small></p>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Lista de Clientes</h4>
        <button class="btn btn-success" @onclick="AgregarCliente">+ Agregar Cliente</button>
    </div>

    @if (!clientes.Any())
    {
        <p>No hay clientes registrados.</p>
    }
    else
    {
        <table class="table table-bordered table-striped shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>DNI</th>
                    <th>Email</th>
                    <th>Teléfono</th>
                    <th>Género</th>
                    <th>Pago</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var cliente in clientes)
                {
                    <tr>
                        <td>@cliente.nombre</td>
                        <td>@cliente.apellido</td>
                        <td>@cliente.dni</td>
                        <td>@cliente.email</td>
                        <td>@cliente.telefono</td>
                        <td>@cliente.genero</td>
                        <td>@(cliente.pago ? "Sí" : "No")</td>
                        <td>
                            <button class="btn btn-warning btn-sm me-2" @onclick="() => EditarCliente(cliente.dni)">Editar</button>
                            <button class="btn btn-danger btn-sm" @onclick="() => EliminarCliente(cliente.dni)">Eliminar</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
}

@code {
    [Parameter] public string dni { get; set; } = string.Empty;
    private Entrenador? entrenador;
    private List<Cliente> clientes = new();

    protected override void OnParametersSet()
    {
        entrenador = EntrenadorService.TraerTodos().FirstOrDefault(e => e.dni == dni);

        if (entrenador != null)
        {
            clientes = ClienteService.TraerTodos();
        }
        else
        {
            Console.WriteLine($"⚠️ No se encontró entrenador con DNI: {dni}");
        }
    }

    private void AgregarCliente()
    {
        Navigation.NavigateTo($"/agregar-cliente/{dni}");
    }

    private void EditarCliente(string dniCliente)
    {
        Navigation.NavigateTo($"/editar-cliente/{dniCliente}/{entrenador.dni}");

    }

    private void EliminarCliente(string dniCliente)
    {
        var cliente = ClienteService.TraerTodos().FirstOrDefault(x => x.dni == dniCliente);
        if (cliente != null)
        {
            ClienteService.EliminarCliente(cliente.Id);
            clientes.Remove(cliente);
        }
    }
    private void VolverAtras()
    {
        Navigation.NavigateTo("/", forceLoad: true);
    }

}
