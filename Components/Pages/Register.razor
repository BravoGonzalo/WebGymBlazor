@layout Components.Layout.EmptyLayout
@page "/registrar-entrenador"
@rendermode InteractiveServer
@inject ProyectoGym.Business.EntrenadorService EntrenadorService
@inject NavigationManager Nav
@using ProyectoGym.Domain
@using System.ComponentModel.DataAnnotations

<div class="card shadow-lg p-4" style="width: 450px; border-radius: 1rem;">
    <h3 class="text-center mb-4 text-success">Registro de Entrenador</h3>

    <EditForm Model="@registerModel" OnValidSubmit="@HandleRegister" FormName="registrarEntrenador">
        <DataAnnotationsValidator />

        <div class="mb-3">
            <label class="form-label">Nombre</label>
            <InputText @bind-Value="registerModel.Nombre" class="form-control" placeholder="Ingrese su nombre" />
            <ValidationMessage For="() => registerModel.Nombre" class="text-danger" />
        </div>

        <div class="mb-3">
            <label class="form-label">Apellido</label>
            <InputText @bind-Value="registerModel.Apellido" class="form-control" placeholder="Ingrese su apellido" />
            <ValidationMessage For="() => registerModel.Apellido" class="text-danger" />
        </div>

        <div class="mb-3">
            <label class="form-label">Email</label>
            <InputText @bind-Value="registerModel.Email" class="form-control" placeholder="Ingrese su email" />
            <ValidationMessage For="() => registerModel.Email" class="text-danger" />
        </div>

        <div class="mb-3">
            <label class="form-label">Contraseña</label>
            <InputText @bind-Value="registerModel.Contraseña" type="password" class="form-control" placeholder="Ingrese su contraseña" />
            <ValidationMessage For="() => registerModel.Contraseña" class="text-danger" />
        </div>

        <div class="mb-3">
            <label class="form-label">Confirmar Contraseña</label>
            <InputText @bind-Value="registerModel.ConfirmarContraseña" type="password" class="form-control" placeholder="Confirme su contraseña" />
            <ValidationMessage For="() => registerModel.ConfirmarContraseña" class="text-danger" />
        </div>
        <div class="mb-3">
            <label class="form-label">DNI</label>
            <InputText @bind-Value="registerModel.Dni" class="form-control" placeholder="Ingrese su DNI" />
            <ValidationMessage For="() => registerModel.Dni" class="text-danger" />
        </div>

        <div class="mb-3">
            <label class="form-label">Dirección</label>
            <InputText @bind-Value="registerModel.Direccion" class="form-control" placeholder="Ingrese su dirección" />
        </div>

        <div class="mb-3">
            <label class="form-label">Teléfono</label>
            <InputText @bind-Value="registerModel.Telefono" class="form-control" placeholder="Ingrese su teléfono" />
        </div>

        <div class="mb-3">
            <label class="form-label">Género</label>
            <InputSelect @bind-Value="registerModel.Genero" class="form-control">
                @foreach (Sexo sexo in Enum.GetValues(typeof(Sexo)))
                {
                    <option value="@sexo">@sexo</option>
                }
            </InputSelect>
        </div>

        <div class="d-grid mb-3">
            <button type="submit" class="btn btn-success">Registrarse</button>
        </div>
    </EditForm>

    @if (!string.IsNullOrEmpty(message))
    {
        <div class="alert alert-info py-2 text-center">@message</div>
    }

    <div class="text-center mt-3">
        <span>¿Ya tenés cuenta? </span>
        <NavLink class="btn btn-link p-0 text-decoration-none" href="/login">
            Ingresá acá
        </NavLink>
    </div>
</div>
@code {
    private RegisterModel registerModel = new RegisterModel();
    private string message = "";

    private async Task HandleRegister()
    {
        try
        {
            var entrenador = new Entrenador
            {
                nombre = registerModel.Nombre,
                apellido = registerModel.Apellido,
                email = registerModel.Email,
                dni = registerModel.Dni,
                direccion = registerModel.Direccion,
                telefono = registerModel.Telefono,
                genero = registerModel.Genero,

                contraseña = registerModel.Contraseña
            };

            EntrenadorService.CrearEntrenador(entrenador);

            message = "¡Registro exitoso! Redirigiendo al login...";
            StateHasChanged();

            registerModel = new RegisterModel();

            await Task.Delay(1000);
            Nav.NavigateTo("/login");
        }
        catch (Exception ex)
        {
            message = ex.Message ?? "Error al registrar entrenador.";
            StateHasChanged();
        }
    }

    public class RegisterModel
    {
        [Required(ErrorMessage = "El nombre es obligatorio")]
        public string Nombre { get; set; } = string.Empty;

        [Required(ErrorMessage = "El apellido es obligatorio")]
        public string Apellido { get; set; } = string.Empty;

        [Required(ErrorMessage = "El email es obligatorio")]
        [EmailAddress(ErrorMessage = "El email no tiene formato válido")]
        public string Email { get; set; } = string.Empty;

        [Required(ErrorMessage = "La contraseña es obligatoria")]
        [MinLength(6, ErrorMessage = "La contraseña debe tener al menos 6 caracteres")]
        public string Contraseña { get; set; } = string.Empty;

        [Required(ErrorMessage = "Debe confirmar la contraseña")]
        [Compare(nameof(Contraseña), ErrorMessage = "Las contraseñas no coinciden")]
        public string ConfirmarContraseña { get; set; } = string.Empty;

        [Required(ErrorMessage = "El DNI es obligatorio")]
        public string Dni { get; set; } = string.Empty;

        public string Direccion { get; set; } = string.Empty;
        public string Telefono { get; set; } = string.Empty;
        public Sexo Genero { get; set; } = Sexo.Indefinido;
    }
}